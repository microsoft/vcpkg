diff --git a/src/colmap/estimators/covariance.cc b/src/colmap/estimators/covariance.cc
index 6040583..e111c44 100644
--- a/src/colmap/estimators/covariance.cc
+++ b/src/colmap/estimators/covariance.cc
@@ -182,7 +182,7 @@ bool ComputeLInverse(Eigen::SparseMatrix<double>& S, Eigen::MatrixXd& L_inv) {
 
   const Eigen::VectorXd D_dense = ldlt_S.vectorD();
 
-  const int rank = D_dense.nonZeros();
+  const int rank = D_dense.size();
   if (rank < S.rows()) {
     LOG(WARNING) << StringPrintf(
         "Unable to compute covariance. The Schur complement on pose/other "
diff --git a/src/colmap/sfm/observation_manager.cc b/src/colmap/sfm/observation_manager.cc
index 04aab21..5751012 100644
--- a/src/colmap/sfm/observation_manager.cc
+++ b/src/colmap/sfm/observation_manager.cc
@@ -36,6 +36,8 @@
 #include "colmap/util/logging.h"
 #include "colmap/util/misc.h"
 
+#include <cassert>
+
 namespace colmap {
 
 bool MergeAndFilterReconstructions(const double max_reproj_error,
