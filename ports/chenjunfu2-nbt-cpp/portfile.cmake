vcpkg_from_github(
    OUT_SOURCE_PATH SOURCE_PATH
    REPO chenjunfu2/NBT_CPP
    REF "v${VERSION}"
    HEAD_REF master
    SHA512 fb1e1f352199e8625d1451bfa46394f063514f6cd92d119ebd7a2010a264befd85e569ce1ad0fd19e149f1e3fa1f5ca9626acf61c6270e60a0b85c44cd093da0
)

file(INSTALL "${SOURCE_PATH}/include/nbt_cpp/"
     DESTINATION "${CURRENT_PACKAGES_DIR}/include/nbt_cpp"
     FILES_MATCHING
     PATTERN "*.hpp"
     PATTERN "*.h"
     PATTERN "vcpkg_config.h" EXCLUDE
)

set(CONFIG_HEADER_CONTENT "//Auto-generated by vcpkg - DO NOT EDIT\n\n")

if("zlib" IN_LIST FEATURES)
    set(CONFIG_HEADER_CONTENT "${CONFIG_HEADER_CONTENT}//use zlib\n")
    set(CONFIG_HEADER_CONTENT "${CONFIG_HEADER_CONTENT}#ifndef __USE_ZLIB__\n")
    set(CONFIG_HEADER_CONTENT "${CONFIG_HEADER_CONTENT}#define __USE_ZLIB__\n")
    set(CONFIG_HEADER_CONTENT "${CONFIG_HEADER_CONTENT}#else\n")
    set(CONFIG_HEADER_CONTENT "${CONFIG_HEADER_CONTENT}#undef __USE_ZLIB__\n")
    set(CONFIG_HEADER_CONTENT "${CONFIG_HEADER_CONTENT}#endif\n\n")
endif()

if("xxhash" IN_LIST FEATURES)
    set(CONFIG_HEADER_CONTENT "${CONFIG_HEADER_CONTENT}//use xxhash\n")
    set(CONFIG_HEADER_CONTENT "${CONFIG_HEADER_CONTENT}#ifndef __USE_XXHASH__\n")
    set(CONFIG_HEADER_CONTENT "${CONFIG_HEADER_CONTENT}#define __USE_XXHASH__\n")
    set(CONFIG_HEADER_CONTENT "${CONFIG_HEADER_CONTENT}#else\n")
    set(CONFIG_HEADER_CONTENT "${CONFIG_HEADER_CONTENT}#undef __USE_XXHASH__\n")
    set(CONFIG_HEADER_CONTENT "${CONFIG_HEADER_CONTENT}#endif\n\n")
endif()

file(WRITE "${CURRENT_PACKAGES_DIR}/include/nbt_cpp/vcpkg_config.h" "${CONFIG_HEADER_CONTENT}")

if(EXISTS "${SOURCE_PATH}/LICENSE")
    file(INSTALL "${SOURCE_PATH}/LICENSE"
         DESTINATION "${CURRENT_PACKAGES_DIR}/share/${PORT}"
         RENAME copyright)
elseif(EXISTS "${SOURCE_PATH}/LICENSE.md")
    file(INSTALL "${SOURCE_PATH}/LICENSE.md"
         DESTINATION "${CURRENT_PACKAGES_DIR}/share/${PORT}"
         RENAME copyright)
endif()