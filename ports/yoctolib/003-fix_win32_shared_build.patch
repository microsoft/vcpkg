diff --git a/Sources/CMakeLists.txt b/Sources/CMakeLists.txt
index 2684a6c..96886bd 100644
--- a/Sources/CMakeLists.txt
+++ b/Sources/CMakeLists.txt
@@ -181,12 +181,21 @@ add_library (YoctoLib ${YoctoLibCppSources} ${YoctoLibHSources})
 
 # add yapi low level api
 add_subdirectory(yapi)
-target_link_libraries(YoctoLib PUBLIC yapi)
+if(BUILD_SHARED_LIBS)
+	target_link_libraries(YoctoLib PRIVATE yapi)
+else()
+	target_link_libraries(YoctoLib PUBLIC yapi)
+endif()
 target_include_directories (YoctoLib
 	PUBLIC
 		$<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}>
+		$<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/yapi>
 		$<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}>
+		$<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}/yapi>
 )
+if(WIN32 AND BUILD_SHARED_LIBS)
+	target_compile_definitions(YoctoLib PRIVATE GENERATE_DLL)
+endif()
 set_target_properties(YoctoLib PROPERTIES SOVERSION 1)
 set_target_properties(YoctoLib PROPERTIES LIBRARY_OUTPUT_NAME yocto)
 install(FILES ${YoctoLibHSources} DESTINATION ${CMAKE_INSTALL_INCLUDEDIR})
@@ -203,12 +212,21 @@ configure_package_config_file(
 	"${CMAKE_CURRENT_BINARY_DIR}/YoctoLibConfig.cmake"
 	INSTALL_DESTINATION share/YoctoLib
 )
-install(TARGETS YoctoLib yapi
-	EXPORT YoctoLibTargets
-	RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
-	LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
-	ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
-)
+if(BUILD_SHARED_LIBS)
+	install(TARGETS YoctoLib
+		EXPORT YoctoLibTargets
+		RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
+		LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
+		ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
+	)
+else()
+	install(TARGETS YoctoLib yapi
+		EXPORT YoctoLibTargets
+		RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
+		LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
+		ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
+	)
+endif()
 install(EXPORT YoctoLibTargets
 	FILE YoctoLibTargets.cmake
 	NAMESPACE YoctoLib::
diff --git a/Sources/yapi/CMakeLists.txt b/Sources/yapi/CMakeLists.txt
index a06e04c..4ff6314 100644
--- a/Sources/yapi/CMakeLists.txt
+++ b/Sources/yapi/CMakeLists.txt
@@ -134,7 +134,7 @@ set(YAPI_C_FILES
 	yssl.c
 )
 
-add_library (yapi ${YAPI_C_FILES}  ${MBEDTLS_C_FILES})
+add_library (yapi STATIC ${YAPI_C_FILES}  ${MBEDTLS_C_FILES})
 if(USE_YSSL)
 	target_include_directories(yapi PRIVATE mbedtls/include)
 endif()
